
-- upgrade n° de version
UPDATE `system` SET `value`='v3.5.0' WHERE `name`='gynobs';

-- configuration : formulaires de règlements du module
INSERT INTO `configuration` (`name`, `level`, `toID`, `module`, `cat`, `type`, `description`, `value`) VALUES ( 'administratifReglementFormulaires', 'module', '0', 'gynobs', 'Règlements', 'liste', '', 'gynobsReglePorteurS1,gynobsReglePorteurS2');

update `data_types` set label='Règlement', description='Règlement conventionné S1' WHERE `name` = 'gynobsReglePorteurS1';
update `data_types` set label='Règlement', description='Règlement conventionné S2' WHERE `name` = 'gynobsReglePorteurS2';

-- rubrique pour doc à signer
INSERT IGNORE INTO `data_cat` ( `groupe`, `name`, `label`, `description`, `type`, `fromID`, `creationDate`) VALUES
('typecs', 'gynobsCatSupportDocumentsSignerObs', 'Gynécologie Obs. : ordos spécifiques à signer si grossesse', 'support pour formulaires produisant des documents à signer si grossesse active', 'base', 1, '2018-12-17 22:04:54');

-- indiquer le formulaire marqueurs T21 comme pouvant être signé
SET @catID = (SELECT data_cat.id FROM data_cat WHERE data_cat.name='gynobsCatSupportDocumentsSignerObs');
update `data_types` set placeholder='o', cat=@catID where `name`='csMarqueursSerT21';

-- déplacement formulaires dans catégorie spécifique formsProdOrdoEtDoc
SET @catID = (SELECT forms_cat.id FROM forms_cat WHERE forms_cat.name='formsProdOrdoEtDoc');
update forms set cat=@catID where internalName in ('gynObsMarqueursSeriques', 'gynobsGenotypageRhesusFoetalSangMaternel');

-- Utilisation de toute la largeur pour la row1 du form de synthèse obs (gynObsSyntheseObs)
UPDATE `forms` SET `yamlStructure` = replace(yamlStructure, "size: 2", "size: 'col'") where internalName='gynObsSyntheseObs'

-- nouveau formulaire génotypage Rhésus foetal D sur sang maternel

-- data_cat
INSERT IGNORE INTO `data_cat` (`groupe`, `name`, `label`, `description`, `type`, `fromID`, `creationDate`) VALUES
('medical', 'catDataGenotypageRhesusFoetal', 'Données formulaire génotypage rhesus D foetal', 'données pour le formulaire génotypage rhésus D foetal sur sang maternel', 'base', '1', '2018-12-19 11:08:54'),
('typecs', 'gynobsCatSupportDocumentsSignerObs', 'Gynécologie Obs. : ordos spécifiques à signer si grossesse', 'support pour formulaires produisant des documents à signer si grossesse active', 'base', '1', '2018-12-19 11:08:54');

-- data_types
SET @catID = (SELECT data_cat.id FROM data_cat WHERE data_cat.name='catDataGenotypageRhesusFoetal');
INSERT IGNORE INTO `data_types` (`groupe`, `name`, `placeholder`, `label`, `description`, `validationRules`, `validationErrorMsg`, `formType`, `formValues`, `module`, `cat`, `fromID`, `creationDate`, `durationLife`, `displayOrder`) VALUES
('medical', 'fGenRhFoePatienteOrigineGeo', NULL, 'Origine géographique de la patiente', 'origine géographique de la patiente', NULL, NULL, 'select', '\' \' : \' \' \n\'E\' : \'Europe\'\n\'AN\' : \'Afrique du nord\'\n\'AoC\' : \'Afrique / Caraïbes\'\n\'MO\' : \'Moyen-Orient\'\n\'As\' : \'Asie\'\n\'Autre\' : \'Autre\'', 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1'),
('medical', 'fGenRhFoeProcreateurOrigineGeo', NULL, 'Origine géographique du procréateur', 'origine géographique du procréateur', NULL, NULL, 'select', '\' \' : \' \' \n\'E\' : \'Europe\'\n\'AN\' : \'Afrique du nord\'\n\'AoC\' : \'Afrique / Caraïbes\'\n\'MO\' : \'Moyen-Orient\'\n\'As\' : \'Asie\'\n\'Autre\' : \'Autre\'', 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1'),
('medical', 'fGenRhFoePatienteOrigineGeoAutre', 'Précisez ici l\'origine géographique', 'Autre origine géographique de la patiente', 'Autre origine géographique de la patiente', NULL, NULL, 'text', NULL, 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1'),
('medical', 'fGenRhFoeProcreateurOrigineGeoAutre', 'Précisez ici l\'origine géographique', 'Autre origine géographique du procreateur', 'Autre origine géographique du procreateur', NULL, NULL, 'text', NULL, 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1'),
('medical', 'fGenRhFoePatienteTypeGro', NULL, 'Type de grossesse', 'type de grossesse', NULL, NULL, 'select', '\'u\' : \'mono-foetal\'\n\'g\' : \'gémellaire\'', 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1'),
('medical', 'fGenRhFoePatienteSuivieCNRHP', NULL, 'Patiente suivie au CNRHP', 'patiente suivie au CNRHP', NULL, NULL, 'select', '\'n\' : \'non\'\n\'o\' : \'oui\'', 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1'),
('medical', 'fGenRhFoePatienteAlloImmAntiDConnue', NULL, 'Patiente avec allo-immunisation anti-D connue', 'patiente avec allo-immunisation anti-D connue', NULL, NULL, 'select', '\'n\' : \'non\'\n\'o\' : \'oui\'', 'gynobs', @catID, '1', '2018-12-19 11:08:54', '3600', '1');

SET @catID = (SELECT data_cat.id FROM data_cat WHERE data_cat.name='gynobsCatSupportDocumentsSignerObs');
INSERT IGNORE INTO `data_types` (`groupe`, `name`, `placeholder`, `label`, `description`, `validationRules`, `validationErrorMsg`, `formType`, `formValues`, `module`, `cat`, `fromID`, `creationDate`, `durationLife`, `displayOrder`) VALUES
('typecs', 'csGenotypageRhesusFoetalSangMaternel', 'o', 'Génotypage Rhésus D fœtal', 'support parent pour génotypage rhésus D fœtal', NULL, NULL, NULL, 'gynobsGenotypageRhesusFoetalSangMaternel', 'gynobs', @catID, '1', '2018-12-19 11:08:54', '84600', '1');

-- forms_cat
INSERT IGNORE INTO `forms_cat` (`name`, `label`, `description`, `type`, `fromID`, `creationDate`) VALUES
('formsProdOrdoEtDoc', 'Formulaires de production d\'ordonnances', 'formulaires de production d\'ordonnances et de documents', 'user', '1', '2018-12-19 11:08:54');

-- forms
SET @catID = (SELECT forms_cat.id FROM forms_cat WHERE forms_cat.name='formsProdOrdoEtDoc');
INSERT IGNORE INTO `forms` (`module`, `internalName`, `name`, `description`, `dataset`, `groupe`, `formMethod`, `formAction`, `cat`, `type`, `yamlStructure`, `options`, `printModel`, `cda`, `javascript`) VALUES
('gynobs', 'gynobsGenotypageRhesusFoetalSangMaternel', 'Génotypage rhésus D fœtal à partir du sang maternel', 'formulaire pour ordonnace de génotypage rhésus D fœtal à partir du sang maternel', 'data_types', 'medical', 'post', '/patient/ajax/saveCsForm/', @catID, 'public', 'structure:\r\n row1:\r\n   head: \"Génotypage rhésus D fœtal à partir du sang maternel\"\r\n   col1:\r\n     head: \'Patiente\'    \r\n     size: 5\r\n     bloc:                          \r\n       - fGenRhFoePatienteOrigineGeo               		#1609 Origine géographique de la patiente\n       - fGenRhFoePatienteOrigineGeoAutre,disabled,nolabel,class=d-none 		#1611 Autre origine géographique de la patiente\n       - fGenRhFoePatienteAlloImmAntiDConnue       		#1615 Patiente avec allo-immunisation anti-D connue\n       - fGenRhFoePatienteSuivieCNRHP              		#1614 Patiente suivie au CNRHP\n       - fGenRhFoePatienteTypeGro                  		#1613 Type de grossesse\n   col2:\r\n     head: \'Procréateur\'    \r\n     size: 5\r\n     bloc:                          \r\n       - fGenRhFoeProcreateurOrigineGeo            		#1610 Origine géographique du procréateur\n       - fGenRhFoeProcreateurOrigineGeoAutre,disabled,nolabel,class=d-none 		#1612 Autre origine géographique du procreateur', NULL, 'ordoGenotypageRhesusFoetal', NULL, '$(\'body\').on(\"change\", \'#id_fGenRhFoePatienteOrigineGeo_id\', function() {\r\n  valeur = $(\'#id_fGenRhFoePatienteOrigineGeo_id\').val();\r\n  if (valeur == \'Autre\') {\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').removeClass(\'d-none\');\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').removeAttr(\'disabled\');\r\n  } else {\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').addClass(\'d-none\');\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').val(\'\');\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').attr(\'disabled\', \'disabled\');\r\n  }\r\n});\r\n\r\n$(\'body\').on(\"change\", \'#id_fGenRhFoeProcreateurOrigineGeo_id\', function() {\r\n  valeur = $(\'#id_fGenRhFoeProcreateurOrigineGeo_id\').val();\r\n  if (valeur == \'Autre\') {\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').removeClass(\'d-none\');\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').removeAttr(\'disabled\');\r\n  } else {\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').addClass(\'d-none\');\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').val(\'\');\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').attr(\'disabled\', \'disabled\');\r\n  }\r\n});\r\n\r\n\r\n// Restaurer à l\'édition \r\n$(\'#id_fGenRhFoeProcreateurOrigineGeo_id, #id_fGenRhFoePatienteOrigineGeo_id\').trigger( \"change\" );');

-- forms : inclure le JS en base
UPDATE forms set javascript='poids = $(\"#id_poids_id\").val();\r\nif (poids < 1) alert(\"ATTENTION !\\nLe poids de la patiente n\'est pas précisé actuellement dans le dossier !\\nIl est nécessaire de l\'indiquer avant validation du formulaire.\");\r\n\r\n$(\'#formName_gynObsMarqueursSeriques input[type=\"submit\"]\').attr(\'disabled\', \'disabled\');\r\n\r\n$(\'body\').on(\'change\', \'#formName_gynObsMarqueursSeriques select\', function() {\r\n  aucunblanc = true;\r\n  $(\'#formName_gynObsMarqueursSeriques select\').each(function(index) {\r\n    if ($(this).prop(\'selectedIndex\') == 0) aucunblanc = false;\r\n  });\r\n\r\n  if (aucunblanc) {\r\n    $(\'#formName_gynObsMarqueursSeriques input[type=\"submit\"]\').removeAttr(\'disabled\');\r\n  } else {\r\n    $(\'#formName_gynObsMarqueursSeriques input[type=\"submit\"]\').attr(\'disabled\', \'disabled\');\r\n  }\r\n});' where internalName='gynObsMarqueursSeriques';
UPDATE forms set javascript='function conclusionComp() {\r\n  txt = \'\';\r\n  nbFoetus = parseInt($(\'#id_nbFoetusEcho32_id\').val());\r\n  if (nbFoetus == \'1\') {\r\n    if ($(\'#id_e32poidsFA_id\').val() > 0) txt = \'EPF : \' + $(\'#id_e32poidsFA_id\').val() + \'g (\' + $(\'#id_e32poidsFA_idAddOn\').text() + \') - Présentation : \' + $(\'#id_e32presentationFA_id option:selected\').text();\r\n  } else if (nbFoetus > 1) {\r\n    if ($(\'#id_e32poidsFA_id\').val() > 0) txt = $.trim(\'Foetus A - EPF : \' + $(\'#id_e32poidsFA_id\').val() + \'g (\' + $(\'#id_e32poidsFA_idAddOn\').text() + \') / Présentation : \' + $(\'#id_e32presentationFA_id option:selected\').text());\r\n\r\n    if ($(\'#id_e32poidsFB_id\').val() > 0) txt = txt + \"\\n\" + $.trim(\'Foetus B - EPF : \' + $(\'#id_e32poidsFB_id\').val() + \'g (\' + $(\'#id_e32poidsFB_idAddOn\').text() + \') / Présentation : \' + $(\'#id_e32presentationFB_id option:selected\').text());\r\n\r\n    if ($(\'#id_e32poidsFC_id\').val() > 0) txt = txt + \"\\n\" + $.trim(\'Foetus C - EPF : \' + $(\'#id_e32poidsFC_id\').val() + \'g (\' + $(\'#id_e32poidsFC_idAddOn\').text() + \') / Présentation : \' + $(\'#id_e32presentationFC_id option:selected\').text());\r\n\r\n  }\r\n\r\n  $(\'#id_e32concluAutomat_id\').val(txt);\r\n}\r\n\r\n//observation nombre foetus\r\n$(\'body\').on(\"keyup, change\", \'#id_nbFoetusEcho32_id\', function() {\r\n  afficherFxNbFoetus();\r\n});\r\n\r\n// calcul du poids et percentils\r\n$(\'body\').on(\"change, keyup\", \"#id_e32bipFA_id, #id_e32bipFB_id, #id_e32bipFC_id, #id_e32pcFA_id, #id_e32paFA_id, #id_e32femurA_id, #id_e32pcFB_id, #id_e32paFB_id, #id_e32femurB_id, #id_e32pcFC_id, #id_e32paFC_id, #id_e32femurC_id\", function() {\r\n  poidsFoetal(\'#id_e32pcFA_id\', \'#id_e32paFA_id\', \'#id_e32femurA_id\', \'#id_e32poidsFA_id\');\r\n  poidsFoetal(\'#id_e32pcFB_id\', \'#id_e32paFB_id\', \'#id_e32femurB_id\', \'#id_e32poidsFB_id\');\r\n  poidsFoetal(\'#id_e32pcFC_id\', \'#id_e32paFC_id\', \'#id_e32femurC_id\', \'#id_e32poidsFC_id\');\r\n\r\n  //foetus A\r\n  displayPercentiles(\'#id_e32bipFA_id\', \'bip\');\r\n  displayPercentiles(\'#id_e32pcFA_id\', \'pc\');\r\n  displayPercentiles(\'#id_e32paFA_id\', \'pa\');\r\n  displayPercentiles(\'#id_e32femurA_id\', \'lf\');\r\n\r\n  //foetus B\r\n  if ($(\'.foetusB\').is(\':visible\')) {\r\n    displayPercentiles(\'#id_e32bipFB_id\', \'bip\');\r\n    displayPercentiles(\'#id_e32pcFB_id\', \'pc\');\r\n    displayPercentiles(\'#id_e32paFB_id\', \'pa\');\r\n    displayPercentiles(\'#id_e32femurB_id\', \'lf\');\r\n  }\r\n\r\n  //foetus C\r\n  if ($(\'.foetusC\').is(\':visible\')) {\r\n    displayPercentiles(\'#id_e32bipFC_id\', \'bip\');\r\n    displayPercentiles(\'#id_e32pcFC_id\', \'pc\');\r\n    displayPercentiles(\'#id_e32paFC_id\', \'pa\');\r\n    displayPercentiles(\'#id_e32femurC_id\', \'lf\');\r\n  }\r\n\r\n  // compléter la conclusion\r\n  conclusionComp();\r\n\r\n});\r\n\r\n// MoM\r\n$(\'body\').on(\"change, keyup\", \"#id_e32dopACMVFA_id, #id_e32dopACMVFB_id, #id_e32dopACMVFC_id\", function() {\r\n    if($(this).val() > 0) {\r\n      mom = momCalc($(this).val(), $(\'#id_termeDuJour_id\').attr(\'data-tdj4math\'));\r\n    } else {\r\n      mom = \'\';\r\n    }\r\n    idsource = $(this).attr(\'id\');\r\n    if (idsource == \'id_e32dopACMVFA_id\') $(\'#id_e32dopACMMoMFA_id\').val(mom);\r\n    if (idsource == \'id_e32dopACMVFB_id\') $(\'#id_e32dopACMMoMFB_id\').val(mom);\r\n    if (idsource == \'id_e32dopACMVFC_id\') $(\'#id_e32dopACMMoMFC_id\').val(mom);\r\n  \r\n});\r\n\r\n//changement de la présentation : adapter la conclusion automatique complémentaire\r\n$(\'body\').on(\"change\", \"#id_e32presentationFA_id, #id_e32presentationFB_id, #id_e32presentationFC_id\", function() {\r\n  conclusionComp();\r\n});\r\n\r\n// Restauration édition \r\n$(\"#id_e32bipFA_id, #id_e32bipFB_id, #id_e32bipFC_id\").trigger(\'keyup\');\r\n$(\"#id_e32dopACMVFA_id, #id_e32dopACMVFB_id, #id_e32dopACMVFC_id\").trigger(\'keyup\');' where internalName='gynObsEcho32';
UPDATE forms set javascript='//observation nombre foetus\r\n$(\'body\').on(\"keyup, change\", \'#id_nbFoetusEcho12_id\', function() {\r\n  afficherFxNbFoetus();\r\n});\r\n\r\n//calcul du terme en fonction lcc\r\n$(\'body\').on(\"change, keyup\", \"#id_lccA_id, #id_lccB_id, #id_lccC_id\", function() {\r\n  if ($(\'#id_lccA_id\').val() > 0) majLCC2Terme($(\'#id_lccA_id\').val(), \'#id_termeLCCFA_id\');\r\n  if ($(\'#id_lccB_id\').val() > 0) majLCC2Terme($(\'#id_lccB_id\').val(), \'#id_termeLCCFB_id\');\r\n  if ($(\'#id_lccC_id\').val() > 0) majLCC2Terme($(\'#id_lccC_id\').val(), \'#id_termeLCCFC_id\');\r\n});\r\n\r\n//définir comme DGE\r\n$(\'body\').on(\"dblclick\", \"#id_termeLCCFA_id, #id_termeLCCFB_id, #id_termeLCCFC_id\", function(event) {\r\n  setDGE(event);\r\n});\r\n$(\'body\').on(\"click\", \"#id_termeLCCFA_idAddOn, #id_termeLCCFB_idAddOn, #id_termeLCCFC_idAddOn\", function(event) {\r\n  event.preventDefault();\r\n  setDGE(event);\r\n});\r\n\r\n// Restaurer à l\'édition\r\nif ($(\'#id_lccA_id\').val() > 0) majLCC2Terme($(\'#id_lccA_id\').val(), \'#id_termeLCCFA_id\');\r\nif ($(\'#id_lccB_id\').val() > 0) majLCC2Terme($(\'#id_lccB_id\').val(), \'#id_termeLCCFB_id\');\r\nif ($(\'#id_lccC_id\').val() > 0) majLCC2Terme($(\'#id_lccC_id\').val(), \'#id_termeLCCFC_id\');' where internalName='gynObsEcho12';
UPDATE forms set javascript='//echos IG : observation nombre foetus\r\n$(\'body\').on(\"keyup, change\", \'#id_igNbFoetus_id\', function() {\r\n  afficherFxNbFoetus();\r\n});\r\n\r\n//issue grossesse : calcul terme à l\'acc\r\n$(\'body\').on(\"focusout\", \'#id_igDate_id\', function() {\r\n  terme = termeAccCalc($(\'#id_igDate_id\').val(), $(\'#id_DDR_id\').val(), $(\'#id_ddgReel_id\').val());\r\n  if (terme != null) {\r\n    $(\'#id_igTermeFA_id, #id_igTermeFB_id, #id_igTermeFC_id\').val(terme);\r\n  }\r\n});' where internalName='gynObsFinGrossesse';
UPDATE forms set javascript='//calculer nb jour du cycle\r\n$(\'body\').on(\"focusout\", \'#id_eGynDDR_id\', function() {\r\n  ddr = $(\'#id_eGynDDR_id\').val();\r\n  var today = moment().startOf(\'day\');\r\n  var ddrm = moment(ddr, \"DD-MM-YYYY\");\r\n\r\n  if (ddrm.isValid()) {\r\n    jours = today.diff(ddrm, \'days\') + 1;\r\n    $(\'#id_eGynDDR_idAddOnG\').text(\'J\' + jours);\r\n  }\r\n});' where internalName='gynObsEchoGyneco';
UPDATE forms set javascript='// observation nombre foetus\r\n$(\'body\').on(\"keyup, change\", \'#id_nbFoetusEcho22_id\', function() {\r\n  afficherFxNbFoetus();\r\n});\r\n\r\n// calcul du poids et percentils\r\n$(\'body\').on(\"change, keyup\", \"#id_e22bipFA_id, #id_e22bipFB_id, #id_e22bipFC_id, #id_e22pcFA_id, #id_e22paFA_id, #id_e22femurA_id, #id_e22pcFB_id, #id_e22paFB_id, #id_e22femurB_id, #id_e32pcFC_id, #id_e22paFC_id, #id_e22femurC_id\", function() {\r\n\r\n  poidsFoetal(\'#id_e22pcFA_id\', \'#id_e22paFA_id\', \'#id_e22femurA_id\', \'#id_e22poidsFA_id\');\r\n  poidsFoetal(\'#id_e22pcFB_id\', \'#id_e22paFB_id\', \'#id_e22femurB_id\', \'#id_e22poidsFB_id\');\r\n  poidsFoetal(\'#id_e22pcFC_id\', \'#id_e22paFC_id\', \'#id_e22femurC_id\', \'#id_e22poidsFC_id\');\r\n\r\n  //foetus A\r\n  displayPercentiles(\'#id_e22bipFA_id\', \'bip\');\r\n  displayPercentiles(\'#id_e22pcFA_id\', \'pc\');\r\n  displayPercentiles(\'#id_e22paFA_id\', \'pa\');\r\n  displayPercentiles(\'#id_e22femurA_id\', \'lf\');\r\n\r\n  //foetus B\r\n  if ($(\'.foetusB\').is(\':visible\')) {\r\n    displayPercentiles(\'#id_e22bipFB_id\', \'bip\');\r\n    displayPercentiles(\'#id_e22pcFB_id\', \'pc\');\r\n    displayPercentiles(\'#id_e22paFB_id\', \'pa\');\r\n    displayPercentiles(\'#id_e22femurB_id\', \'lf\');\r\n  }\r\n\r\n  //foetus C\r\n  if ($(\'.foetusC\').is(\':visible\')) {\r\n    displayPercentiles(\'#id_e22bipFC_id\', \'bip\');\r\n    displayPercentiles(\'#id_e22pcFC_id\', \'pc\');\r\n    displayPercentiles(\'#id_e22paFC_id\', \'pa\');\r\n    displayPercentiles(\'#id_e22femurC_id\', \'lf\');\r\n  }\r\n});\r\n\r\n// MoM\r\n$(\'body\').on(\"change, keyup\", \"#id_e22dopACMVFA_id, #id_e22dopACMVFB_id, #id_e22dopACMVFC_id\", function() {\r\n  if($(this).val() > 0) {\r\n    mom = momCalc($(this).val(), $(\'#id_termeDuJour_id\').attr(\'data-tdj4math\'));\r\n  } else {\r\n    mom = \'\';\r\n  }\r\n  idsource = $(this).attr(\'id\');\r\n  if (idsource == \'id_e22dopACMVFA_id\') $(\'#id_e22dopACMMoMFA_id\').val(mom);\r\n  if (idsource == \'id_e22dopACMVFB_id\') $(\'#id_e22dopACMMoMFB_id\').val(mom);\r\n  if (idsource == \'id_e22dopACMVFC_id\') $(\'#id_e22dopACMMoMFC_id\').val(mom);\r\n});\r\n\r\n// Restaurer à l\'édition \r\n$(\"#id_e22bipFA_id, #id_e22bipFB_id, #id_e22bipFC_id\").trigger( \"keyup\" );' where internalName='gynObsEcho22';
UPDATE forms set javascript='// observation nombre foetus\r\n$(\'body\').on(\"keyup, change\", \'#id_e11nbembryons_id\', function() {\r\n  afficherFxNbFoetus();\r\n});\r\n\r\n//calcul du terme en fonction lcc\r\n$(\'body\').on(\"change, keyup\", \"#id_e11embryLCCFA_id, #id_e11embryLCCFB_id, #id_e11embryLCCFC_id\", function() {\r\n  //E11\r\n  if ($(\'#id_e11embryLCCFA_id\').val() > 0) majLCC2Terme($(\'#id_e11embryLCCFA_id\').val(), \'#id_E11termeLCCFA_id\');\r\n  if ($(\'#id_e11embryLCCFB_id\').val() > 0) majLCC2Terme($(\'#id_e11embryLCCFB_id\').val(), \'#id_E11termeLCCFB_id\');\r\n  if ($(\'#id_e11embryLCCFC_id\').val() > 0) majLCC2Terme($(\'#id_e11embryLCCFC_id\').val(), \'#id_E11termeLCCFC_id\');\r\n});\r\n\r\n//définir comme DGE\r\n$(\'body\').on(\"dblclick\", \" #id_E11termeLCCFA_id, #id_E11termeLCCFB_id, #id_E11termeLCCFC_id\", function(event) {\r\n  setDGE(event);\r\n});\r\n$(\'body\').on(\"click\", \" #id_E11termeLCCFA_idAddOn, #id_E11termeLCCFB_idAddOn, #id_E11termeLCCFC_idAddOn\", function(event) {\r\n  event.preventDefault();\r\n  setDGE(event);\r\n});\r\n\r\n// Restaurer à l\'édition \r\nif ($(\'#id_e11embryLCCFA_id\').val() > 0) majLCC2Terme($(\'#id_e11embryLCCFA_id\').val(), \'#id_E11termeLCCFA_id\');\r\nif ($(\'#id_e11embryLCCFB_id\').val() > 0) majLCC2Terme($(\'#id_e11embryLCCFB_id\').val(), \'#id_E11termeLCCFB_id\');\r\nif ($(\'#id_e11embryLCCFC_id\').val() > 0) majLCC2Terme($(\'#id_e11embryLCCFC_id\').val(), \'#id_E11termeLCCFC_id\');' where internalName='gynObsEchoAvt11';
UPDATE forms set javascript='$(\'body\').on(\"change\", \'#id_fGenRhFoePatienteOrigineGeo_id\', function() {\r\n  valeur = $(\'#id_fGenRhFoePatienteOrigineGeo_id\').val();\r\n  if (valeur == \'Autre\') {\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').removeClass(\'d-none\');\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').removeAttr(\'disabled\');\r\n  } else {\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').addClass(\'d-none\');\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').val(\'\');\r\n    $(\'#id_fGenRhFoePatienteOrigineGeoAutre_id\').attr(\'disabled\', \'disabled\');\r\n  }\r\n});\r\n\r\n$(\'body\').on(\"change\", \'#id_fGenRhFoeProcreateurOrigineGeo_id\', function() {\r\n  valeur = $(\'#id_fGenRhFoeProcreateurOrigineGeo_id\').val();\r\n  if (valeur == \'Autre\') {\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').removeClass(\'d-none\');\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').removeAttr(\'disabled\');\r\n  } else {\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').addClass(\'d-none\');\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').val(\'\');\r\n    $(\'#id_fGenRhFoeProcreateurOrigineGeoAutre_id\').attr(\'disabled\', \'disabled\');\r\n  }\r\n});\r\n\r\n\r\n// Restaurer à l\'édition \r\n$(\'#id_fGenRhFoeProcreateurOrigineGeo_id, #id_fGenRhFoePatienteOrigineGeo_id\').trigger( \"change\" );' where internalName='gynobsGenotypageRhesusFoetalSangMaternel';
