-- Modifications des données de la bdd de v3.1.0. à v3.2.0

UPDATE `system` SET `value`='v3.2.0' WHERE `name`='gynobs';

SET @catID = (SELECT data_cat.id FROM data_cat WHERE data_cat.name='porteursReglement');
INSERT IGNORE INTO `data_types` (`groupe`, `name`, `placeholder`, `label`, `description`, `validationRules`, `validationErrorMsg`, `formType`, `formValues`, `module`,`cat`, `fromID`, `creationDate`, `durationLife`, `displayOrder`) VALUES
 ('reglement', 'gynobsReglePorteurS1', '', 'Règlement', 'Règlement conventionné S1', '', '', '', 'baseReglementS1', 'gynobs', @catID, 1, '2018-01-01 00:00:00', 1576800000, 1);

UPDATE `data_types` SET `name`='gynobsReglePorteurS2', `formValues`='baseReglementS2', `description`='Règlement conventionné S2' WHERE `name`='gynobsReglePorteur';

UPDATE `forms` SET `yamlStructure`='structure:\n  row1:                              # 1re rangée\n    col1:                            # 1re colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - poids,plusg={<i class="fa fa-clone duplicate"></i>},plus={kg},class=text-right 		#34   Poids\n    col2:                            # 2e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - taillePatient,plusg={<i class="fa fa-clone duplicate"></i>},plus={cm},class=text-right 		#35   Taille\n    col3:                            # 3e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - imc,readonly,plus={kg/m²},class=text-right 		#43   IMC\n  row2:                              # 2e rangée\n    col1:                            # 1re colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - groupeSanguin                            		#583  Groupe sg\n    col2:                            # 2e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          \n        - toxoStatut                               		#582  Toxo.\n    col3:                            # 3e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          \n        - rubStatut                                		#584  Rubéole\n  row3:                             \n    col1:                           \n      size: col-5\n      bloc:                          \n        - clairanceCreatinine,plus={mL/min},class=text-right 		#922  Clairance créatinine\n    col2:                           \n      size: col-7\n      bloc:   \n        - insuffisanceHepatique                    		#923  Insuffisance hépatique\n  \n  row4:                              # 2e rangée\n    col1:                            # 1re colonne  \n      size: 12\n      bloc:                          # Types utilisés\n        - job                                      		#19   Activité professionnelle\n        - allergies,rows=2                         		#66   Allergies\n        - toxiques                                 		#42   Toxiques\n  row5:                              # 3e rangée\n    col1:                            # 1re colonne  \n      size: 12\n      bloc:                          # Types utilisés\n        - atcdObs,rows=6                           		#573  Antécédents obstétricaux\n        - atcdPersoGyneco,rows=6                   		#572  Antécédents gynécologiques\n        - atcdMedicChir,rows=6                     		#41   Antécédents médico-chirugicaux\n        - atcdFamiliaux,rows=6                     		#38   Antécédents familiaux', `yamlStructureDefaut`='structure:\n  row1:                              # 1re rangée\n    col1:                            # 1re colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - poids,plusg={<i class="fa fa-clone duplicate"></i>},plus={kg},class=text-right 		#34   Poids\n    col2:                            # 2e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - taillePatient,plusg={<i class="fa fa-clone duplicate"></i>},plus={cm},class=text-right 		#35   Taille\n    col3:                            # 3e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - imc,readonly,plus={kg/m²},class=text-right 		#43   IMC\n  row2:                              # 2e rangée\n    col1:                            # 1re colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          # Types utilisés\n        - groupeSanguin                            		#583  Groupe sg\n    col2:                            # 2e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          \n        - toxoStatut                               		#582  Toxo.\n    col3:                            # 3e colonne  \n      size: 12 col-12 col-sm-4 col-lg-4\n      bloc:                          \n        - rubStatut                                		#584  Rubéole\n  row3:                             \n    col1:                           \n      size: col-5\n      bloc:                          \n        - clairanceCreatinine,plus={mL/min},class=text-right 		#922  Clairance créatinine\n    col2:                           \n      size: col-7\n      bloc:   \n        - insuffisanceHepatique                    		#923  Insuffisance hépatique\n  \n  row4:                              # 2e rangée\n    col1:                            # 1re colonne  \n      size: 12\n      bloc:                          # Types utilisés\n        - job                                      		#19   Activité professionnelle\n        - allergies,rows=2                         		#66   Allergies\n        - toxiques                                 		#42   Toxiques\n  row5:                              # 3e rangée\n    col1:                            # 1re colonne  \n      size: 12\n      bloc:                          # Types utilisés\n        - atcdObs,rows=6                           		#573  Antécédents obstétricaux\n        - atcdPersoGyneco,rows=6                   		#572  Antécédents gynécologiques\n        - atcdMedicChir,rows=6                     		#41   Antécédents médico-chirugicaux\n        - atcdFamiliaux,rows=6                     		#38   Antécédents familiaux' WHERE `internalName`='gynObsATCD';

-- Correction des glyphicon pour bs4
update `forms` set yamlStructure = REPLACE(yamlStructure, 'termeLCCFA,readonly ','termeLCCFA,readonly,plus={<i class="fa fa-save"></i>} ');
update `forms` set yamlStructure = REPLACE(yamlStructure, 'termeLCCFB,disabled,readonly ','termeLCCFB,disabled,readonly,plus={<i class="fa fa-save"></i>} ');
update `forms` set yamlStructure = REPLACE(yamlStructure, 'termeLCCFC,disabled,readonly ','termeLCCFC,disabled,readonly,plus={<i class="fa fa-save"></i>} ');

update `forms` set yamlStructure = REPLACE(yamlStructure, 'E11termeLCCFA,readonly ','E11termeLCCFA,readonly,plus={<i class="fa fa-save"></i>} ');
update `forms` set yamlStructure = REPLACE(yamlStructure, 'E11termeLCCFB,disabled,readonly ','E11termeLCCFB,disabled,readonly,plus={<i class="fa fa-save"></i>} ');
update `forms` set yamlStructure = REPLACE(yamlStructure, 'E11termeLCCFC,disabled,readonly ','E11termeLCCFC,disabled,readonly,plus={<i class="fa fa-save"></i>} ');

update `forms` set yamlStructure = REPLACE(yamlStructure, 'glyphicon glyphicon-save','fa fa-save');

update `forms` set yamlStructure = REPLACE(yamlStructure, 'imc,readonly,plus={<i class="fa fa-chart-line graph"></i>}','imc,readonly') where internalName = 'gynObsATCD';

-- Passage des datas grossesse dans base
update `data_types` set module='base' where name in ('nouvelleGrossesse', 'groFermetureSuivi', 'ddgReel', 'ddg', 'DDR', 'terme9mois','termeDuJour' );

-- Petite correction
UPDATE `data_types` SET `formValues` = '' WHERE name = 'DDR';
DELETE from `data_types` where name in ('porteurCatPres1', 'porteurPresNonMedic');

-- Configuration propre au module
INSERT IGNORE INTO `configuration` (`name`, `level`, `toID`, `module`, `cat`, `type`, `description`, `value`) VALUES
('lapActiverAtcdStrucSur', 'module', 0, 'gynobs', 'LAP', 'texte', '', 'atcdObs,atcdPersoGyneco,atcdMedicChir'),
('lapActiverAllergiesStrucSur', 'module', 0, 'gynobs', 'LAP', 'texte', '', 'allergies'),
('lapAtcdStrucPersoPourAnalyse', 'module', 0, 'gynobs', 'LAP', 'texte', '', 'atcdObs,atcdPersoGyneco,atcdMedicChir'),
('lapAllergiesStrucPersoPourAnalyse', 'module', 0, 'gynobs', 'LAP', 'texte', '', 'allergies');

-- Reclassement des forms de synthèse patient
SET @catID = (SELECT forms_cat.id FROM forms_cat WHERE forms_cat.name='formSynthese');
update forms set cat=@catID where name in('gynObsSyntheseObs','gynObsSyntheseGyn');
