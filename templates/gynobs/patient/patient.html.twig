{#
 # This file is part of MedShakeEHR.
 #
 # Copyright (c) 2017
 # Bertrand Boutillier <b.boutillier@gmail.com>
 # http://www.medshake.net
 #
 # MedShakeEHR is free software: you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation, either version 3 of the License, or
 # any later version.
 #
 # MedShakeEHR is distributed in the hope that it will be useful,
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
 # along with MedShakeEHR.  If not, see <http://www.gnu.org/licenses/>.
 #/

/##
 # Template > patient : dossier patient
 #
 # @author Bertrand Boutillier <b.boutillier@gmail.com>
 #}

{% extends "page.html.twig" %}
{% import "macroForm.html.twig" as f %}
{% block title %}MedShakeEHR :
    {{ page['patient']['administrativeDatas']['3']['value']|e }}
    {{ page['patient']['administrativeDatas']['2']['value']|e }}{% endblock %}

{% block head %}
    {{ parent() }}
    <script defer src="{{ config.protocol }}{{ config.host }}/bower_components/tinymce/tinymce.min.js"></script>
    <script defer src="{{ config.protocol }}{{ config.host }}/bower_components/tinymce/jquery.tinymce.min.js"></script>
    <script defer src="{{ config.protocol }}{{ config.host }}/js/patient.js"></script>
    <script defer src="{{ config.protocol }}{{ config.host }}/js/module/common.js"></script>

    <style>
        .foetusB,
        .foetusC {
            display: none;
        }

        #newDoc{
          display: none;
        }

    </style>

    {# provoquer l'envoie asynchrone du patient dans le DICOM si config ok #}
    {# formulaire JS à charger #}
    <script>
      var dicomAutoSendPatient2Echo = {{ config.dicomAutoSendPatient2Echo }};

    {% if page.listeForms|length > 0 %}
      var formScripts = new Array({{ page.listeForms|join(',') }});
    {% endif %}
    </script>

{% endblock %}

{% block body %}

    <div class="container-fluid">

        <div class="row" id="identitePatient" data-patientID="{{ page.patient.id }}">

            <h1>{{ page['patient']['administrativeDatas']['3']['value']|e }}
                {# firstname #}
                {{ page['patient']['administrativeDatas']['2']['value']|e }}
                {# name #}
                {% if page['patient']['administrativeDatas']['1']['value'] %}
                    ({{ page['patient']['administrativeDatas']['1']['value']|e }}){% endif %}
                <small>
                    {{ page['patient']['administrativeDatas']['8']['value']|e }}
                    -
                    {# birthdate #}
                    {{ page['patient']['administrativeDatas']['8']['age']|e }}
                    an{% if page['patient']['administrativeDatas']['8']['age'] > 0 %}s{% endif %}
                    {# age #}

                    <a class="btn btn-default btn-xs" role="button" href="/patient/edit/{{ page.patient.id }}/">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </a>
                </small>
            </h1>
            <p>
                {# tel #}
                {{ page['patient']['administrativeDatas']['10']['value']|e }}
                {% if page['patient']['administrativeDatas']['10']['value'] and page['patient']['administrativeDatas']['7']['value'] %} / {% endif %}
                {{ page['patient']['administrativeDatas']['7']['value']|e }}
                {% if (page['patient']['administrativeDatas']['10']['value'] or page['patient']['administrativeDatas']['7']['value']) and page['patient']['administrativeDatas']['4']['value'] %} - {% endif %}

                {# email #}
                <a class="newMail" href="#" data-formtocall="11" data-mailtype="ns">{{ page['patient']['administrativeDatas']['4']['value']|e }}</a>
                -
                {{ page['patient']['administrativeDatas']['9']['value']|e }}
                {{ page['patient']['administrativeDatas']['11']['value']|e }}
                {{ page['patient']['administrativeDatas']['13']['value']|e }}
                {{ page['patient']['administrativeDatas']['12']['value']|e }}

            </p>

        </div>

        <div class="row">

            <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Ordonnance
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                      <a id="linkAddNewOrdo" href="#">Nouvelle prescription</a>
                  </li>
                  <li>
                    <a class="newCS" href="#" data-parentID="{{ page.grossesseEnCours.id }}" data-formtocall="28" data-csID="475" data-mode="create">Marqueurs sériques</a>
                  </li>
                </ul>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Courriers &amp; Certificats
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li class="dropdown-header">Certificats</li>
                    {% for v in page.modelesCertif %}
                        <li>
                            <a class="newCourrier" data-modeleID="{{ v.id }}" href="#">{{ v.label }}</a>
                        </li>
                    {% endfor %}
                    <li role="separator" class="divider"></li>
                    <li class="dropdown-header">Courriers</li>
                    {% for v in page.modelesCourrier %}
                        <li>
                            <a class="newCourrier" data-modeleID="{{ v.id }}" href="#">{{ v.label }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Document
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a id="linkAddNewDoc" href="#">Ajouter un document au dossier</a>
                    </li>
                </ul>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Règlement
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                      <a id="linkAddNewReglement" href="#">Nouveau règlement</a>
                  </li>
                </ul>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    DICOM
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                      <a href="#" class="catchLastDicomSrData">Récupérer mesures</a>
                  </li>
                  <li>
                      <a href="/dicom/{{ page.patient.id }}/" target="_blank">Voir tous les examens du patient</a>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                      <a href="#" class="prepareEcho">Envoyer patiente à échographe</a>
                  </li>
                </ul>
            </div>


        </div>

        <div class="row" style="margin-top : 40px;">
            {# Formulaire dlatéral des ATCD #}
            <div id="latForm" class="col-md-3 changeObserv">
                {{ f.formbuilder(page.formLat , 4 , valFormLat ) }}
            </div>

            {# colonne principale #}
            <div class="col-md-9" style="padding-left : 35px">

                {# Div d'import de nouveau doc #}
                <div id="newDoc" class="row">{% include 'importDocForm.html.twig' %}</div>

                {# historique du jour #}
                {% if page.patient.today %}{% include 'patientHistoriqueToday.html.twig' %}{% endif %}

                {# Div d'insertion de nouveau reglement #}
                <div id="newReglement" class="row"></div>

                {# Div d'insertion de nouveau courrier #}
                <div id="newCourrier" class="row"></div>

                {# Div d'insertion de nouvelle ordonance #}
                <div id="newOrdo" class="row"></div>

                {# Div d'insertion de nouvelle consultation #}
                <div id="nouvelleCs" class="row"></div>

                {# Div d'insertion de nouveau mail  #}
                <div id="newMail" class="row"></div>

              {# Synthèse obstétrique #}
              {% if page.grossesseEnCours.id > 0 %} {% include 'synthesGrossesseEnCours.html.twig' %} {% endif %}
              {# Synthèse gynéco #}
              {% include 'synthesGyneco.html.twig' %}

              {# Historique complet #}
              {% if page.patient.historique %}{% include 'patientHistoriqueMedical.html.twig' %}{% endif %}
            </div>
          </div>

    </div>

    {# modal changer nom consultation ou doc #}
    <div class="modal fade" id="alternatTitreModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
      aria-hidden="true">&times;</span></button>

            <h4 class="modal-title" id="exampleModalLabel">Compléter le titre</h4>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="titreActu" class="control-label">Complément :</label>
                <input type="text" class="form-control" id="titreActu">
                <input type="hidden" id="objetID" value="" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
            <button type="button" class="btn btn-primary" id="alternatTitreModalSubmit">Modifier</button>
           </div>
         </div>
       </div>
     </div>


{% endblock %}
